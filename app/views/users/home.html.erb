
<% cache(user_home_cache) do -%>
  
  <div id="col_wrapper">
    
    <% current_user.columns.each do |col| %>
    <div id="col_<%= col.id %>" class="dragable_columns">
      <span class="column_ctl">
        <span class="ctl_close"></span>
        <span class="ctl_handle"></span>
        <span class="ctl_add"></span>
      </span>
      <% col.boxes.each do |box| %>
      <div id="boxid_<%= box.id %>" class="dragable_boxes">
      <div id="boxid_<%= box.id %>_style" class="box <%= box.style %>">
        <div id="boxid_<%= box.id %>_header" class="box_header clearfix">
          <%= link_to_remote_for_box_actions(box,'down') %>
          <span class="box_title"><span class="box_handle">&nbsp;</span><%= link_to_remote_for_box_title(box) %></span>
        </div>
        <div id="boxid_<%= box.id %>_line" class="line">&nbsp;</div>
        <div id="boxid_<%= box.id %>_inside" class="inside" style="display:<%= box.collapsed? ? 'none' : 'block' %>;">
          <ul id="boxid_list_<%= box.id %>" class="sortablelist">
            <% box.bookmarks.each do |bmark| -%>
              <%= render :inline => bookmark_list_item, :locals => {:bmark => bmark, :box_type => 'box'} %>
            <% end %>
          </ul>
        </div>
      </div>
      </div>
      <% end %>
    </div>
    <% end %>
    
    <div id="welcome_box" class="center" style="display:<%= current_user.columns.blank? ? 'block' : 'none' %>;">
      <div id="welcome_header" class="site_yellow">
        Welcome to your <br />
        HomeMarks start page.
      </div>
      <div id="welcome_message">
        Get started by creating your first column, then new boxes within it. If you are unsure how to do this, please take a 
        moment to read over the <%= link_to 'documentation and help', site_path('help') %> section.
      </div>
    </div>
  
  </div>
  
  
  <div id="bookmark_sortables">
    <script type="text/javascript">
    //<![CDATA[
    <%# render(:update) {|page| page.create_bookmark_sortables(current_user)} %>
    //]]>
    </script>
  </div>
  
  <div id="box_sortables">
    <script type="text/javascript">
    //<![CDATA[
    <%# render(:update) {|page| page.create_box_sortables(current_user)} %>
    //]]>
    </script>
  </div>

  <div id="column_sortable">
    <script type="text/javascript">
    //<![CDATA[
    <%# render(:update) {|page| page.create_column_sortable} %>
    //]]>
    </script>
  </div>
  
  <% if session[:demo] == true -%>
  <script type="text/javascript" charset="utf-8">
    var demoinaround = alert('This demo account may produce errors since it is shared with other public visitors. All account actions are disabled and this account will even reset to its own defaults every few hours. Enjoy.');
  </script>
  <% end -%>

<% end -%>
